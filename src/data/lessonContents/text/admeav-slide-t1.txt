# T1 Â· Hand-Crafted Feature Extraction

## Objetivos de la lecciÃ³n
- Diferenciar descriptores globales y locales para representar imÃ¡genes.
- Repasar mÃ©tricas estadÃ­sticas clÃ¡sicas para caracterizar texturas.
- Comprender el funcionamiento de LBP, HOG, SIFT y filtros de Gabor.
- Identificar fortalezas y limitaciones de las caracterÃ­sticas diseÃ±adas manualmente.

## Esquema de contenidos
- IntroducciÃ³n y fundamentos de los descriptores.
- EstadÃ­sticos de primer y segundo orden.
- Local Binary Patterns (LBP) y sus variantes invariantes.
- Histogram of Oriented Gradients (HOG).
- Descriptores basados en puntos clave: SIFT.
- Bancos de filtros y respuestas en frecuencia (Gabor).

![Panorama de descriptores clÃ¡sicos](figure:admeav/t1-taxonomy)
Caption: RelaciÃ³n entre descriptores globales, locales y basados en puntos clave utilizados en visiÃ³n clÃ¡sica.

## Â¿QuÃ© es una caracterÃ­stica?
- Valor numÃ©rico que captura un aspecto relevante (color, textura, forma) de una imagen completa o de una regiÃ³n.
- Debe ser **discriminativa** (valores cercanos para ejemplos similares) y **robusta** frente a ruido o cambios moderados.
- Normalmente se combinan en **vectores de caracterÃ­sticas** para describir objetos o escenas.

## MetodologÃ­a de extracciÃ³n
- **Descriptores globales**: se calculan sobre la imagen completa (histogramas de color, momentos geomÃ©tricos).
- **Descriptores locales**: se aplican sobre regiones o puntos clave.
  - DivisiÃ³n en parches regulares.
  - DetecciÃ³n de landmarks (Harris, DoG) y posterior descripciÃ³n.
- Pipeline tÃ­pico: detecciÃ³n â†’ descripciÃ³n â†’ agregaciÃ³n (bag-of-words, concatenaciÃ³n).

## EstadÃ­sticos clÃ¡sicos
- **Primer orden** (histograma): media, varianza, asimetrÃ­a, curtosis, entropÃ­a.
- **Segundo orden** (matriz de co-ocurrencias): captura dependencia espacial entre intensidades.
  - Permite derivar contraste, correlaciÃ³n, energÃ­a, homogeneidad.
- **Ã“rdenes superiores**: modelados complejos (momento centralizado, cumulantes).

## Local Binary Patterns
- Comparan cada pÃ­xel con sus vecinos: valores mayores reciben 1, menores 0; el patrÃ³n binario describe la textura.
- Se parametriza con **P vecinos** y **radio R**. Se generan histogramas de patrones para caracterizar una regiÃ³n.
- Variantes:
  - **LBPri**: agrupa patrones equivalentes bajo rotaciones.
  - **LBPriu2**: se queda con patrones uniformes (mÃ¡ximo dos transiciones) para reducir dimensionalidad.
- Ãštiles para texturas finas y robustos a cambios de iluminaciÃ³n suaves.

## Histogram of Oriented Gradients
- Divide la imagen en celdas, calcula gradientes y acumula orientaciones ponderadas por magnitud.
- Normaliza bloques contiguos para ganar invariancia a iluminaciÃ³n y contraste.
- Popular en detecciÃ³n de peatones y objetos rÃ­gidos gracias a su sensibilidad a bordes.

## SIFT
- Detecta puntos clave mediante diferencia de gaussianas en escala y localiza extremos subpÃ­xel.
- Asigna orientaciÃ³n dominante para lograr invariancia a rotaciÃ³n.
- Describe cada punto con histogramas de gradiente locales (128 dimensiones clÃ¡sicas).
- Estable para correspondencias entre imÃ¡genes con cambios de escala, rotaciÃ³n y moderados cambios de iluminaciÃ³n.

## Filtros de Gabor
- Simulan receptores de la corteza visual: senos modulados por gaussianas.
- Responden a frecuencias y orientaciones especÃ­ficas; bancos multiescala capturan texturas.
- Ãštiles en reconocimiento facial, anÃ¡lisis de texturas y biometrÃ­a.

## Ventajas y limitaciones
- **Ventajas**: interpretables, requerimientos de datos moderados, buen rendimiento en dominios controlados.
- **Limitaciones**: sensibilidad a transformaciones complejas, dificultad para generalizar sin ingenierÃ­a manual, dimensionalidad alta al combinar mÃºltiples descriptores.
19
Original: i MÃ¡scara: mask Luminancia: ig LBP Histograma LBP
sana
CÃ¡ncer 
grado 3
CÃ¡ncer 
grado 5

Index
1.Introduction
2.Statistical descriptors
3.Local Binary Patterns
4.Histogram of Oriented Gradients
5.SIFT
6.Gabor Filters
20

Histograms of Oriented
Gradients (HOG)
â€¢ The histogram of oriented gradients (HOG ) is a widely used descriptor in image 
processing for the purpose of object detection. The technique counts the occurrences of 
gradient orientation in localised portions of an image. 
â€¢ Algorithm:
â€“ Gradient calculation
â€“ Grouping the orientations
â€“ Block descriptor
â€“ Block normalisation
21

22
Convolution
7275716359626674
7275706258616572
6973696359636871
6973696259626770
7274706157596470
6869686563646668
6769696766676970
6366676564666869
-101
-202
-101
10-1
20-2
10-1
ğ‘¦ ğ‘š, ğ‘›àµŒ ğ‘¥ ğ‘š, ğ‘›âˆ— â„ğ‘š, ğ‘›àµŒ à· à· ğ‘¥ğ‘˜, ğ‘™â„ áˆ¾ ğ‘šàµ†ğ‘˜, ğ‘›àµ†ğ‘™áˆ¿
à¯Ÿà¯
Kernel
â„áˆ¾àµ†ğ‘˜, àµ†ğ‘™]â„áˆ¾ğ‘˜, ğ‘™]
àµ†1 âˆ—62 àµ…0 âˆ—59 àµ…1 âˆ—62 àµ…áˆºàµ†2áˆ»âˆ— 59 àµ…0 âˆ—57 àµ…2 âˆ—61 àµ…áˆºàµ†1áˆ»âˆ— 64 àµ…0 âˆ—63 àµ…1 âˆ—65 àµŒ 3
3
Imagen de salida
22

23
Gradient Computation
-101
-202
-101
121
000
-1-2-1
ğ‘€ğ‘ğ‘”ğ‘›ğ‘–ğ‘¡ğ‘¢ğ‘‘ğ‘’ àµŒ ğºà¯«à¬¶ àµ…ğºà¯¬à¬¶
ğºà¯« ğºà¯¬
ğ‘‚ğ‘Ÿğ‘–ğ‘’ğ‘›ğ‘¡ğ‘ğ‘¡ğ‘–ğ‘œğ‘› àµŒtanà¬¿à¬µ ğºà¯¬
ğºà¯« 23

Histograms of Oriented
Gradients (HOG)
â€¢ Division of the image into cells of fixed size.  
â€¢ Calculation of a histogram of the orientations in each cell.
â€¢ Global descriptor combines histograms of all cells.
24
orientation

Histograms of Oriented
Gradients (HOG)
â€¢ Division of the range of orientations into a fixed number of intervals.
â€¢ Assign each pixel in the cell to an interval based on the gradient orientation.
â€¢ Accumulate the gradient magnitude of all pixels assigned to an interval.
25
orientation
orientation

Histograms of Oriented
Gradients (HOG)
Orientation histogram calculation: interpolation in orientation
â€¢ Problems
â€“ Gradients with very similar orientations  can be assigned to different intervals.
â€“ Sensitive to small gradient variations.
â€¢ Solution:
â€“ Assign each gradient to the two closest intervals with a we ight proportional to the distance from the orientation 
to the centre of each interval.
26
orientation
orientation

Histograms of Oriented
Gradients (HOG)
Assign each gradient to the two closest intervals with a weight proportional to the distance from 
the orientation to the centre of each interval.
ğ‘” ğ‘¥, ğ‘¦àµŒ 100
ğœƒ ğ‘¥, ğ‘¦àµŒ 45Âº
Assuming that for the histogram calculation the orientation is divided into 9 intervals (without 
considering the sign), what would be the contribution of this pixel to each of the intervals of the 
histogram?
27

Histograms of Oriented
Gradients (HOG)
Assign each gradient to the two closest intervals with a weight proportional to the distance from 
the orientation to the centre of each interval.
ğ‘” ğ‘¥, ğ‘¦àµŒ 100
ğœƒ ğ‘¥, ğ‘¦àµŒ 45Âº
Assuming that for the histogram calculation the orientation is divided into 9 intervals (without 
considering the sign), what would be the contribution of this pixel to each of the intervals of the 
histogram?
28
00 000007525

Histograms of Oriented
Gradients (HOG)
29
Orientation histogram calculation: spatial integration
â€¢ A histogram is calculated for each of the cells.
â€¢ Each pixel contributes to the histogram of its corresponding cell.
ğ‘–
ğ‘—
1  2  3 4  5  6  7  8  9

Histograms of Oriented
Gradients (HOG)
30
Orientation histogram calculation: spatial integration
â€¢ Problems
â€¢ Pixels in close proximity can be assigned to different cells.
â€¢ Sensitive to small variations in object shape.
â€¢ Solution:
â€¢ Assign each pixel to the four nearest cells with a weight proportional to the distance of the pixel from the centre
of each cell.
1  2  3 4  5  6  7  8  9

Histograms of Oriented
Gradients (HOG)
31
Given an image and the division into cells as shown and assuming that the orientation is divided 
into 9 intervals without considering the sign (0Âº-180Âº), in which histograms (ğ‘–,ğ‘—) of the final 
representation and in which intervals ğ‘˜ and with which weight will the pixel (ğ‘¥=12,ğ‘¦=18) with 
orientation ğœƒàµŒ 60Âº contribute?

Histograms of Oriented
Gradients (HOG)
32
Given an image and the division into cells as shown and assuming that the orientation is divided 
into 9 intervals without considering the sign (0Âº-180Âº), in which histograms (ğ‘–,ğ‘—) of the final 
representation and in which intervals ğ‘˜ and with which weight will the pixel (ğ‘¥=12,ğ‘¦=18) with 
orientation ğœƒàµŒ 60Âº contribute?

Histograms of Oriented
Gradients (HOG)
33
Block normalisation
â€¢ Grouping of cells in blocks of b x b cells.
â€¢ Single vector per block concatenating the histograms of all cells.
â€¢ Vector normalisation using the L2 norm.
ğ¶à¬µà¬µ ğ¶à¬µà¬¶
ğ¶à¬¶à¬µ ğ¶à¬¶à¬¶
ğ‘£àµŒáˆº ğ‘¥à¬µ, ğ‘¥à¬¶,â€¦, ğ‘¥à¯‡áˆ»
ğ‘£á‡± àµŒ ğ‘£
ğ‘£ à¬¶
à¬¶ àµ…ğœ€
àµŒ ğ‘£
ğ‘¥à¬µ
à¬¶ àµ…ğ‘¥à¬¶
à¬¶ àµ…â‹¯àµ…ğ‘¥ à¯‡
à¬¶ àµ…ğœ€

Histograms of Oriented
Gradients (HOG)
34
Final descriptor 
â€¢ Block overlap.  
â€¢ For each block, normalised histogram of cells.
â€¢ Final descriptor: concatenation of all block histograms 
ğ»ğ‘‚ğº àµŒ áˆºğ‘¥à¬µ, ğ‘¥à¬¶â€¦ ğ‘¥à¯‡)

Histograms of Oriented
Gradients (HOG)
35
Final descriptor
â€¢ Each cell contributes to the description of several blocks.
â€¢ In each block with a different normalization.

Index
1.Introduction
2.Statistical descriptors
3.Local Binary Patterns
4.Histogram of Oriented Gradients
5.SIFT
6.Gabor Filters
36

37
Keypoint detector
Test image Detector: locates 
single-scale or multi-
scale points of interest.
Descriptor: 
Content invariant 
representation
(HOG, SIFT, etc.)

38
Harrisâ€™ detector
ïƒº
ïƒº
ïƒº
ïƒ»
ïƒ¹
ïƒª
ïƒª
ïƒª
ïƒ«
ïƒ©
ï€½
ïƒ¥ïƒ¥
ïƒ¥ïƒ¥
ïƒïƒ
ïƒïƒ
xx
xx
x
y
x
xy
x
yx
x
x
xxx
xxx
x
N
N
N
N
)()()(
)()()(
)( 2
2
III
III
C
ïƒºïƒ»
ïƒ¹
ïƒªïƒ«
ïƒ©ï€½
2
1
Î»0
0Î»)(xCExample
General case RRC ïƒºïƒ»
ïƒ¹
ïƒªïƒ«
ïƒ©ï€½ ï€­
2
11
Î»0
0Î»)(x
1Î» 2Î»
1Î» 2Î»high and       small: edge
1Î» 2Î»small and       high: edge
1Î» 2Î»
For each pixel is calculated:
and         high: corner
and         small: flat area

39
Harrisâ€™ detector
â€¢ Algorithm designed for motion tracking.
â€¢ Reduces calculation time co mpared to tracking all points. 
â€¢ Invariant to translation and rotation.
â€¢ Not invariant to scale changes.
â€¢ Algorithm
â€“ Reduce image noise (Gaussian filter for example).
â€“ Image gradients calculation.
â€“ Construct the matrix C for each pixel.
â€“ Obtain and analyse determinant (          ) and trace (              )  
of the matrix C.
21 Î»Î» ïƒ—
 21 Î»Î» ï€«

40
Matching of features
Original images
Keypoints (corners) 
detected with Harrisâ€™ 
detector

41
Matching of features
CORRELATION
ïƒ¥ïƒ¥
ïƒ¥
ïƒïƒ
ïƒïƒ
ï€½
2211
2211
2
2
2
1
,
21
21
)()(
)()(
),(
xx
xx
xx
xx
xx
xx
xx
NN
NN
ss
ss
R

42
Matching of features
Need for a robust algorithm
Search of matchings: Putative matchings

43
Robust estimation
RANSAC (RANdom SAmple Consensus)
Algorithm
1. Take a sample: minimum number of points to 
estimate the model.
2. Look at the support of that model: number of points 
below a distance t (consensusset).
3. Repeat the process for N samples and select the 
model with the highest support.
4. Points with a distance less than t are 
inliers.Reestimate the model with all inliers.

44
Example RANSAC
Initial matches
Robust estimation

45
RANSAC estimation: Panoramic image construction
Robust estimation

46
Robust estimation
RANSAC estimation: Panoramic image construction

47
Robust estimation
RANSAC estimation: Panoramic image construction

48
SIFT Detector
SIFT (Scale Invariant Feature Transform)
â€¢ Invariant descriptor to position, scale, rotation, illumination, contrast and point of
view.
â€¢ Algorithm
1. Detection of extremes in scale and space: Extract rotation and scale
invariant points of interest (keypoints).
2. Eliminate â€˜weakâ€™ keypoints.
3. Orientation assignment: Assign one or more orientations to each point of
interest.
4. Keypoint descriptor: Use local gradients at the selected scale.
D. Lowe, â€œDistinctive Image Features from Scale-Invariant  Keypointsâ€, International Journal of 
Computer Vision, 60(2):91-110, 2004.

49
SIFT: Extrema detection 
k0Ïƒ0
k1Ïƒ0
ğ· ğ‘¥, ğ‘¦, ğœàµŒ ğ¿ ğ‘¥, ğ‘¦, ğ‘˜ğœ àµ†ğ¿ ğ‘¥, ğ‘¦, ğœ
ğ¿ ğ‘¥, ğ‘¦, ğœàµŒ ğº ğ‘¥, ğ‘¦, ğœâˆ— ğ¼ ğ‘¥, ğ‘¦,
ğ‘˜à¯Œ àµŒ 2à¯Œ

50
SIFT: Weak keypoints elimination
(a)Image 233x189
(b) 832 extreme DoG
(c) 729 left after low contrast 
thresholding
(d) 536 after Hessian ratio
Weak keypoints
â€¢ keypoints with low contrast (<0.03).
â€¢ Bad edge

51
SIFT Descriptor
Orientation assignment
â€¢ Histogram of gradient directions for each keypoint.
â€¢ Histogram weighted by the magnitude of the gradient and by a 
Gaussian function with Ïƒ=1.5 s.
22( ,) (( 1 ,) ( 1 ,) ) (( , 1 ) ( , 1 ) )
( , ) tan 2(( ( , 1) ( , 1)) / ( ( 1, ) ( 1, )))
mxy Lx y Lx y Lxy Lxy
x ya L x y L x y L x yL x y
ï±
ï€½ï€« ï€­ ï€­ï€«ï€« ï€­ï€­
ï€½ï€« ï€­ ï€­ ï€« ï€­ ï€­
ğ¿ ğ‘¥, ğ‘¦, ğœàµŒ ğº ğ‘¥, ğ‘¦, ğœâˆ— ğ¼ ğ‘¥, ğ‘¦,
0 2 ï°

52
SIFT descriptor
Orientation assignment
1. 16 x16 window around each keypoint.
2. Divide into 4x4 cells.
3. Calculate the histogram in each cell (partial vote).
(8 bins)
16 histograms x 8 orientations 
= 128 features

SIFT Detector

SIFT: Matching of features
Descriptor with mÃ­nimum distance
Problems with ambiguities
I1 I2
ïƒ¥
ï€½
ï€­ï€½
N
i
ii ffffSSD
1
2
2121 )(),(
f1
 f2

SIFT: Matching of features
Problems with ambiguities
I1 I2
f1
 f2

Index
1.Introduction
2.Statistical descriptors
3.Local Binary Patterns
4.Histogram of Oriented Gradients
5.SIFT
6.Gabor Filters
56

Gabor filters
â€¢ Bank of linear filters.
â€¢ Each filter analyzes whether there is any specific  frequency content in the image in specific 
directions.
â€¢ Image analysis with Gabor filters is thought by some to be similar to perception in the human 
visual system.
Source: Deep Learning: Foundations and 
Concepts. Christopher M. Bishop and Hugh 
Bishop